import discord
from discord.ext import commands

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
TOKEN = 'token.txt'
SERVER_ID = 1338512816818229289  # ID –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
CHANNEL_ID = 1402355254908944475  # ID –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ–≥–æ –∫–∞–Ω–∞–ª–∞
USER_IDS = [721685738361454592, 678157951977914378]  # ID –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞
intents = discord.Intents.default()
intents.messages = True
intents.guilds = True
intents.message_content = True

bot = commands.Bot(command_prefix='!', intents=intents)

async def send_notification(user, thread, channel):
    try:
        await user.send(
            f"'''üö® **–ù–æ–≤—ã–π —Ç—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω!**\n"
            f"**–°–µ—Ä–≤–µ—Ä:** {thread.guild.name}\n"
            f"**–ö–∞–Ω–∞–ª:** {channel.name}\n"
            f"**–¢—Ä–µ–¥:** {thread.name}'''\n"
            f"**–°—Å—ã–ª–∫–∞:** {thread.jump_url}"
        )
        print(f"[DONE]: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user.name}")
    except discord.Forbidden:
        print(f"[ERR]: –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user.name} \n(ocyq p.s. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–∏—á–∫—É)")
    except Exception as e:
        print(f"[ERR]: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user.name}: {e}")

@bot.event
async def on_ready():
    print(f'[LaunchService]: –ë–æ—Ç {bot.user} –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!')
    print(f'[LaunchService]: –û—Ç—Å–ª–µ–∂–∏–≤–∞—é —Ç—Ä–µ–¥—ã –≤ –∫–∞–Ω–∞–ª–µ {CHANNEL_ID} –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ {SERVER_ID}')
    print(f'[LaunchService]: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º!')

@bot.event
async def on_thread_create(thread):
    if thread.guild.id == SERVER_ID and thread.parent_id == CHANNEL_ID:
        channel = bot.get_channel(CHANNEL_ID)
        for user_id in USER_IDS:
            try:
                user = await bot.fetch_user(user_id)
                await send_notification(user, thread, channel)
            except discord.NotFound:
                print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}: {e}")

bot.run(TOKEN)
